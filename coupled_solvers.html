
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Coupling Code for Numerical Tools - aka ðŸ¥¥ CoCoNuT is a Python tool for partitioned multiphysics simulations with a focus on fluid-structure interaction.">
      
      
      
        <link rel="canonical" href="https://pyfsi.github.io/coconut/coupled_solvers.html">
      
      
        <link rel="prev" href="convergence_criteria.html">
      
      
        <link rel="next" href="models.html">
      
      
      <link rel="icon" href="assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.11">
    
    
      
        <title>Coupled solvers - CoCoNuT</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="light-green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#coupled-solvers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="CoCoNuT" class="md-header__button md-logo" aria-label="CoCoNuT" data-md-component="logo">
      
  <img src="images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CoCoNuT
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Coupled solvers
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="light-green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="light-green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pyfsi/coconut" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pyfsi/coconut
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="index.html" class="md-tabs__link">
        
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="coupling_components.html" class="md-tabs__link">
          
  
  Coupling components

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="data_structure.html" class="md-tabs__link">
        
  
    
  
  Data structure

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="docs.html" class="md-tabs__link">
        
  
    
  
  Documentation

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="examples.html" class="md-tabs__link">
          
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="tests.html" class="md-tabs__link">
        
  
    
  
  Tests

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="CoCoNuT" class="md-nav__button md-logo" aria-label="CoCoNuT" data-md-component="logo">
      
  <img src="images/logo.png" alt="logo">

    </a>
    CoCoNuT
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pyfsi/coconut" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pyfsi/coconut
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Coupling components
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Coupling components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="coupling_components.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="convergence_criteria.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Convergence criteria
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Coupled solvers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Coupled solvers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Coupled solvers
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="coupled_solvers.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Coupled solvers
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-class-coupledsolver" class="md-nav__link">
    <span class="md-ellipsis">
      The class CoupledSolver
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gauss-seidel" class="md-nav__link">
    <span class="md-ellipsis">
      Gauss-Seidel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relaxation" class="md-nav__link">
    <span class="md-ellipsis">
      Relaxation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aitken" class="md-nav__link">
    <span class="md-ellipsis">
      Aitken
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iqni" class="md-nav__link">
    <span class="md-ellipsis">
      IQNI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ibqn" class="md-nav__link">
    <span class="md-ellipsis">
      IBQN
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iqnism" class="md-nav__link">
    <span class="md-ellipsis">
      IQNISM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explicit" class="md-nav__link">
    <span class="md-ellipsis">
      Explicit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-way" class="md-nav__link">
    <span class="md-ellipsis">
      One-way
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-single-solver" class="md-nav__link">
    <span class="md-ellipsis">
      Test single solver
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test single solver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dummy-solver" class="md-nav__link">
    <span class="md-ellipsis">
      Dummy solver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-results" class="md-nav__link">
    <span class="md-ellipsis">
      Save results
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restart" class="md-nav__link">
    <span class="md-ellipsis">
      Restart
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Restart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#saving-restart-files" class="md-nav__link">
    <span class="md-ellipsis">
      Saving restart files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performing-restart" class="md-nav__link">
    <span class="md-ellipsis">
      Performing restart
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="models.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mappers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mappers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="predictors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Predictors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Solver wrappers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Solver wrappers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="solver_wrappers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="abaqus.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abaqus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fluent.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="kratos_structure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KratosStructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="openfoam.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFOAM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="python.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="data_structure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data structure
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="docs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="examples.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Breaking dam
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Breaking dam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="breaking_dam_fluent2d_abaqus2d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 2D - Abaqus 2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="breaking_dam_fluent2d_kratos_structure2d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 2D - KratosStructure 2D
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lid-driven cavity
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Lid-driven cavity
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lid_driven_cavity_fluent2d_kratos_structure2d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent2D - KratosStructure 2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lid_driven_cavity_openfoam2d_kratos_structure2d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFOAM2D - KratosStructure 2D
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tube
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Tube
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_tube_flow_tube_ringmodel.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python TubeFlow - Python TubeRingmodel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_tube_flow_tube_structure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python TubeFlow - Python TubeStructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_tube_flow_tube_structure_analytical.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python TubeFlow - Python TubeStructure - Analytical
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_tube_flow_tube_structure_surrogate.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python TubeFlow - Python TubeStructure - Surrogate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_tube_flow_abaqus2d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python TubeFlow - Abaqus 2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_fluent2d_tube_structure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 2D - Python TubeStructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_fluent2d_abaqus2d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 2D - Abaqus 2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_fluent2d_abaqus2d_steady.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 2D - Abaqus 2D - Steady
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_fluent2d_abaqus2d_surrogate.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 2D - Abaqus 2D - Surrogate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_fluent3d_abaqus2d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 3D - Abaqus 2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_fluent3d_abaqus3d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 3D - Abaqus 3D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_fluent3d_kratos_structure3d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 3D - KratosStructure 3D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_openfoam3d_abaqus3d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFOAM 3D - Abaqus 3D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tube_openfoam3d_kratos_structure3d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFOAM 3D - KratosStructure 3D
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Turek benchmark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Turek benchmark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="turek_fluent2d_abaqus2d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 2D - Abaqus 2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="turek_fluent2d_abaqus2d_steady.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fluent 2D - Abaqus 2D - Steady
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="turek_openfoam2d_kratos_structure2d.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFOAM 2D - KratosStructure 2D
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="test_single_solver.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test single solver
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="tests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tests
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="coupled-solvers">Coupled solvers</h1>
<p>This documentation describes the different types of coupled solvers which are available. A coupled solver refers to a coupling algorithm used to couple two solvers, typically a flow and a structural solver.
Some of these coupled solvers make use of one or more <a href="https://pyfsi.github.io/coconut/models">models</a>. An odd one out is <code>test_single_solver</code> which allows to test only one solver by coupling it to a dummy solver. 
All coupled solvers inherit from the class <code>CoupledSolver</code>.</p>
<p>In the parameter JSON file, the dictionary <code>coupled_solver</code> holds the <code>type</code> and the dictionary <code>settings</code>, but also the dictionary <code>predictor</code>, the dictionary <code>convergence_criterion</code> and the list <code>solver_wrappers</code> containing dictionaries (one for each solver wrapper, typically two). More information on these last three can be found in the <a href="https://pyfsi.github.io/coconut/predictors">predictors</a>, <a href="https://pyfsi.github.io/coconut/convergence_criteria">convergence criteria</a> and the <a href="https://pyfsi.github.io/coconut/solver_wrappers">solver wrappers</a> documentation, respectively.</p>
<p>In the following subsections, explanatory schematics will be shown. In those schematics, <span class="arithmatex"><span class="MathJax_Preview">\mathcal{F}</span><script type="math/tex">\mathcal{F}</script></span> is the first solver with input <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> and output <span class="arithmatex"><span class="MathJax_Preview">\widetilde{y}</span><script type="math/tex">\widetilde{y}</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\mathcal{S}</span><script type="math/tex">\mathcal{S}</script></span> is the second solver with input <span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> and output <span class="arithmatex"><span class="MathJax_Preview">\widetilde{x}</span><script type="math/tex">\widetilde{x}</script></span>. Typically, these solvers are a flow and structural solver, respectively.
Note that the column vectors such as <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> and <span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> typically contain different components of the same variables or even different variables.
Often, the vectors <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\widetilde{x}</span><script type="math/tex">\widetilde{x}</script></span> contain the three components of displacement, whereas the vectors <span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\widetilde{y}</span><script type="math/tex">\widetilde{y}</script></span> contain the pressure and the three components of traction. However, this has no importance for the coupled solver, as long as the in- and outputs of both solvers correspond to each other.
Further, the superscript <span class="arithmatex"><span class="MathJax_Preview">k=0\dots</span><script type="math/tex">k=0\dots</script></span> denotes the iteration, where <span class="arithmatex"><span class="MathJax_Preview">k+1</span><script type="math/tex">k+1</script></span> is the current iteration.
Finally, the difference between the output <span class="arithmatex"><span class="MathJax_Preview">\widetilde{x}^k</span><script type="math/tex">\widetilde{x}^k</script></span> and input <span class="arithmatex"><span class="MathJax_Preview">x^k</span><script type="math/tex">x^k</script></span> in the same iteration is defined as the residual <span class="arithmatex"><span class="MathJax_Preview">r^k=\widetilde{x}^k-x^k</span><script type="math/tex">r^k=\widetilde{x}^k-x^k</script></span>, which is used to monitor the convergence of the calculation.</p>
<h2 id="the-class-coupledsolver">The class CoupledSolver</h2>
<p>This class is the base class for all coupled solvers.
The following parameters need to be included in the <code>settings</code> dictionary. Here they are listed in alphabetical order.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">parameter</th>
<th style="text-align: center;">type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>anonymous</code></td>
<td style="text-align: center;">bool</td>
<td>(optional) Default: <code>false</code>. If <code>true</code>, the data field <code>info</code>, which contains the hostname of the machine, is not saved, see <a href="#save-results">results pickle file</a>.</td>
</tr>
<tr>
<td style="text-align: right;"><code>debug</code></td>
<td style="text-align: center;">bool</td>
<td>(optional) Default: <code>false</code>. The data <code>solution_x</code> and <code>solution_y</code> are saved every iteration except of every time step (see <a href="#save-results">results pickle file</a>). Residual distribution is also saved in additional field <code>solution_r</code> for every iteration.</td>
</tr>
<tr>
<td style="text-align: right;"><code>delta_t</code></td>
<td style="text-align: center;">float</td>
<td>Fixed time step size used in both solvers. For a steady simulation typically a value of 1 is taken.</td>
</tr>
<tr>
<td style="text-align: right;"><code>case_name</code></td>
<td style="text-align: center;">str</td>
<td>(optional) Default: <code>"case"</code>. Name of the case. This name is used to store a <a href="https://docs.python.org/3/library/pickle.html">pickle</a> file with results (<em><code>&lt;case_name&gt;_results.pickle</code></em>) and a restart file (<em><code>&lt;case_name&gt;_restart_ts&lt;time_step&gt;.pickle</code></em>). If a files already exists, it is overwritten with the exception of the results file upon restart. In that case the new data is appended.</td>
</tr>
<tr>
<td style="text-align: right;"><code>restart_case</code></td>
<td style="text-align: center;">str</td>
<td>(optional) Default: <code>case_name</code>. Only used when restart is performed (<code>timestep_start</code> &gt; 0). Refers to the case which has to be restarted. The following pickle file will be used: <em><code>&lt;restart_case&gt;_restart_ts&lt;timestep_start&gt;.pickle</code></em>. This file path starts in the folder from where the simulation is performed.</td>
</tr>
<tr>
<td style="text-align: right;"><code>save_restart</code></td>
<td style="text-align: center;">int</td>
<td>(optional) Default: <code>-1</code>. Indicates the time step interval at which a restart pickle file has to be saved. A minus sign indicates only the file from the last interval is retained. A save of restart information also triggers a <a href="#save-results">results save</a>, if <code>save_results</code> is non-zero.</td>
</tr>
<tr>
<td style="text-align: right;"><code>save_results</code></td>
<td style="text-align: center;">int</td>
<td>(optional) Default: <code>0</code>. Time step interval at which a pickle file is written containing some main <a href="#save-results">results</a> for ALL previous time steps. If <code>0</code>, no such information is stored and no pickle file is written.</td>
</tr>
<tr>
<td style="text-align: right;"><nobr><code>time_step_start</code></nobr></td>
<td style="text-align: center;">int</td>
<td>Time step number to (re)start a transient FSI calculation. If <code>0</code> is given, the simulation starts from scratch. Otherwise, the code looks for the relevant files to start from the corresponding time step. Not every solver wrapper implements restart, see the corresponding documentation for more information. For a steady simulation, the value should be <code>0</code>.</td>
</tr>
</tbody>
</table>
<p><code>timestep_start</code> and <code>delta_t</code> are necessary parameters (also in a steady simulation), but can also be defined in the solver wrapper directly (e.g. for standalone testing).
If they are defined both here and in the solver wrapper, then the former value is used and a warning is printed.</p>
<p><strong>These parameters should also be specified for the coupled solvers inheriting from <code>CoupledSolver</code>.</strong></p>
<h2 id="gauss-seidel">Gauss-Seidel</h2>
<p>The <code>type</code> for this coupled solver is <code>coupled_solvers.gauss_seidel</code>.</p>
<p>Gauss-Seidel or fixed-point iterations are the simplest way of coupling two solvers: the output of one solver is given to the other one without adjustment.</p>
<p>The following figure shows the basic methodology.</p>
<p><img alt="gauss_seidel" src="images/iteration_gauss_seidel.png" title="Gauss-Seidel iterations" /></p>
<p>Gauss-Seidel iterations are very simple, but unstable for cases with incompressible flow and high added-mass.
A considerable convergence stabilization and acceleration is obtained by modifying the input to one or both of the solvers using derivative information, as will be shown further.</p>
<p>No additional settings are required, besides those for the <a href="#the-class-coupledsolver">class <code>CoupledSolver</code></a>.</p>
<h2 id="relaxation">Relaxation</h2>
<p>The <code>type</code> for this coupled solver is <code>coupled_solvers.relaxation</code>.</p>
<p>Gauss-Seidel iterations are very simple, but are unstable for cases with incompressible flow and high added-mass.
A simple approach to mitigate this is applying relaxation, also called simple mixing. In this coupling method the output of first solver is still given to the other one without adjustment, but the output of the second solver is relaxed as follows:
$$
x^{k+1}=(1-\omega)x^k+\omega\widetilde{x}^k=x^k+\omega r^k
$$
with <span class="arithmatex"><span class="MathJax_Preview">x^k</span><script type="math/tex">x^k</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\widetilde{x}^k</span><script type="math/tex">\widetilde{x}^k</script></span>, respectively the input for the first solver and the output of the second solver in iteration <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span>.
The difference between both is called the residual <span class="arithmatex"><span class="MathJax_Preview">r^k=\widetilde{x}^k-x^k</span><script type="math/tex">r^k=\widetilde{x}^k-x^k</script></span>.
The mixing or relaxation factor is <span class="arithmatex"><span class="MathJax_Preview">\omega</span><script type="math/tex">\omega</script></span>.</p>
<p>A symbolic schematic is given in the following figure.</p>
<p><img alt="relaxation" src="images/iteration_relaxation.png" title="Relaxed Gauss-Seidel iterations" /></p>
<p>This method is again quite simple, but able to stabilize some cases that fail with Gauss-Seidel iterations.
One can see that a lower <span class="arithmatex"><span class="MathJax_Preview">\omega</span><script type="math/tex">\omega</script></span> corresponds to a larger portion of the previous solution to be used. This increases stability, but decreases convergence speed.
For more challenging problems, with incompressible flow and high added-mass, this approach will result in a very slow convergence, if it converges at all.</p>
<p>Beside the parameters required in the <a href="#the-class-coupledsolver">class <code>CoupledSolver</code></a>, the following parameter needs to be included in the <code>settings</code> dictionary.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">parameter</th>
<th style="text-align: center;">type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>omega</code></td>
<td style="text-align: center;">float</td>
<td>Relaxation factor.</td>
</tr>
</tbody>
</table>
<h2 id="aitken">Aitken</h2>
<p>The <code>type</code> for this coupled solver is <code>coupled_solvers.aitken</code>.</p>
<p>Gauss-Seidel iterations are very simple, but are unstable for many cases.
An approach to mitigate this is applying relaxation. However, the choice of a relaxation factor can be difficult: a high factor leads to a higher degree of stability, but a lower convergence speed. In more challenging cases there will be no acceptable value for <span class="arithmatex"><span class="MathJax_Preview">\omega</span><script type="math/tex">\omega</script></span>.
In this coupling method a dynamic relaxation factor is used. The output of the first solver is still given to the other one without adjustment, but the output of the second solver is relaxed as follows:
$$
x^{k+1}=(1-\omega^k)x^k+\omega^k\widetilde{x}^k=x^k+\omega^k r^k
$$
with <span class="arithmatex"><span class="MathJax_Preview">x^k</span><script type="math/tex">x^k</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\widetilde{x}^k</span><script type="math/tex">\widetilde{x}^k</script></span>, respectively the input for the first solver and the output of the second solver in iteration <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span>.
The difference between both is called the residual <span class="arithmatex"><span class="MathJax_Preview">r^k=\widetilde{x}^k-x^k</span><script type="math/tex">r^k=\widetilde{x}^k-x^k</script></span>.
The mixing or relaxation factor is <span class="arithmatex"><span class="MathJax_Preview">\omega^k</span><script type="math/tex">\omega^k</script></span> is dynamic in the sense that its value changes between iterations.</p>
<p>A symbolic schematic is given in the following figure.</p>
<p><img alt="aitken" src="images/iteration_aitken.png" title="Aitken iterations" /></p>
<p>The value of <span class="arithmatex"><span class="MathJax_Preview">\omega^k</span><script type="math/tex">\omega^k</script></span> is determined by applying the secant method for scalars directly to vectors and projecting it on <span class="arithmatex"><span class="MathJax_Preview">r^k-r^{k-1}</span><script type="math/tex">r^k-r^{k-1}</script></span>
as follows
$$
\omega^k=-\omega^{k-1}\frac{(r^{k-1})^T(r^k-r^{k-1})}{(r^k-r^{k-1})^T(r^k-r^{k-1})}.
$$</p>
<p>The first relaxation factor in a time step is equal to the last relaxation factor from the previous time step <span class="arithmatex"><span class="MathJax_Preview">\omega^n</span><script type="math/tex">\omega^n</script></span>, but limited to <span class="arithmatex"><span class="MathJax_Preview">\omega^{max}</span><script type="math/tex">\omega^{max}</script></span>.
$$
\omega^0=\textrm{sign}(\omega^n)\min(|\omega^n|,\omega^{max}).
$$
The relaxation factor in the first time step is equal to <span class="arithmatex"><span class="MathJax_Preview">\omega^{max}</span><script type="math/tex">\omega^{max}</script></span>.</p>
<p>This method improves convergence speed drastically compared to Gauss-Seidel iterations, but even faster convergence can be obtained using quasi-Newton methods, which can be interpreted as using different relaxation factors for different Fourier modes of the output of the second solver.</p>
<p>Beside the parameters required in the <a href="#the-class-coupledsolver">class <code>CoupledSolver</code></a>, the following parameter needs to be included in the <code>settings</code> dictionary.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">parameter</th>
<th style="text-align: center;">type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>omega_max</code></td>
<td style="text-align: center;">float</td>
<td>Maximal relaxation factor.</td>
</tr>
</tbody>
</table>
<h2 id="iqni">IQNI</h2>
<p>The <code>type</code> for this coupled solver is <code>coupled_solvers.iqni</code>.</p>
<p>The abbreviation IQNI refers to <em>interface quasi-Newton with inverse Jacobian</em>. In this type of coupling algorithm, the combination of the two solvers is seen as one system.
The input of the first solver <span class="arithmatex"><span class="MathJax_Preview">\mathcal{F}</span><script type="math/tex">\mathcal{F}</script></span> in iteration <span class="arithmatex"><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> is denoted by <span class="arithmatex"><span class="MathJax_Preview">x^k</span><script type="math/tex">x^k</script></span>. The output of this solver is transferred unchanged to the second solver. The output of the second solver is denoted <span class="arithmatex"><span class="MathJax_Preview">\widetilde{x}^k</span><script type="math/tex">\widetilde{x}^k</script></span>. The difference between output and input is called the residual <span class="arithmatex"><span class="MathJax_Preview">r^k=\widetilde{x}^k-x^k</span><script type="math/tex">r^k=\widetilde{x}^k-x^k</script></span>.</p>
<p>A residual operator <span class="arithmatex"><span class="MathJax_Preview">\mathcal{R}(x)</span><script type="math/tex">\mathcal{R}(x)</script></span> is defined, which returns the residual <span class="arithmatex"><span class="MathJax_Preview">r^k</span><script type="math/tex">r^k</script></span> as a function of <span class="arithmatex"><span class="MathJax_Preview">x^k</span><script type="math/tex">x^k</script></span>. The goal is to find <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> for which <span class="arithmatex"><span class="MathJax_Preview">\mathcal{R}(x)=0</span><script type="math/tex">\mathcal{R}(x)=0</script></span>, i.e. the root. This system of non-linear equations is solved using Newton-Raphson iterations as follows
$$
\Delta x^k=\mathcal{R}'^{-1}(x^k)\Delta r,
$$
where <span class="arithmatex"><span class="MathJax_Preview">\mathcal{R}'</span><script type="math/tex">\mathcal{R}'</script></span> is the Jacobian of <span class="arithmatex"><span class="MathJax_Preview">\mathcal{R}</span><script type="math/tex">\mathcal{R}</script></span> with respect to <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span>, <span class="arithmatex"><span class="MathJax_Preview">\Delta x^k=x^{k+1}-x^k</span><script type="math/tex">\Delta x^k=x^{k+1}-x^k</script></span> is the difference between the input of two subsequent iterations 
and <span class="arithmatex"><span class="MathJax_Preview">\Delta r^k=0-r^k=-r^k</span><script type="math/tex">\Delta r^k=0-r^k=-r^k</script></span> is the difference between the desired and the current residual.
The iteration update can also be written as
$$
x^{k+1}=x^k-\mathcal{R}'^{-1}(x^k)r^k.
$$</p>
<p>However, this Jacobian is not accessible and therefore has to be approximated. Instead of approximating <span class="arithmatex"><span class="MathJax_Preview">\mathcal{R}'</span><script type="math/tex">\mathcal{R}'</script></span>, solving the linear system can be avoided by approximating its inverse directly.</p>
<p>The approximation procedure typically results in a low-rank Jacobian.
Whereas, a full rank Jacobian is required for the Newton-Raphson update to function properly. Therefore, the inverse Jacobian of an altered residual operator <span class="arithmatex"><span class="MathJax_Preview">\widetilde{\mathcal{R}}</span><script type="math/tex">\widetilde{\mathcal{R}}</script></span> is approximated.
This altered residual operator is defined as follows
$$
r^{k+1}=\widetilde{\mathcal{R}}(\widetilde{x}^{k+1})=\mathcal{R}(\widetilde{x}^{k+1}-r^{k+1}).
$$
The inverse of both Jacobians are linked by
$$
\widetilde{\mathcal{R}}'^{-1}=\mathcal{R}'^{-1}+I,
$$
where <span class="arithmatex"><span class="MathJax_Preview">\widetilde{\mathcal{R}}'</span><script type="math/tex">\widetilde{\mathcal{R}}'</script></span> is the Jacobian of <span class="arithmatex"><span class="MathJax_Preview">\widetilde{\mathcal{R}}</span><script type="math/tex">\widetilde{\mathcal{R}}</script></span> with respect to <span class="arithmatex"><span class="MathJax_Preview">\widetilde{x}</span><script type="math/tex">\widetilde{x}</script></span> and <span class="arithmatex"><span class="MathJax_Preview">I</span><script type="math/tex">I</script></span> is the identity matrix.
For this Jacobian the following is valid
$$
\Delta \widetilde{x}^k=\widetilde{\mathcal{R}}'^{-1}(x^k)\Delta r^k,
$$
where <span class="arithmatex"><span class="MathJax_Preview">\Delta\widetilde{x}^k=\widetilde{x}^{k+1}-\widetilde{x}^k</span><script type="math/tex">\Delta\widetilde{x}^k=\widetilde{x}^{k+1}-\widetilde{x}^k</script></span> is the difference between the output of two subsequent iterations.
This Jacobian is also not known, but is approximated using a <code>model</code> and denoted by <span class="arithmatex"><span class="MathJax_Preview">\widetilde{N}^k</span><script type="math/tex">\widetilde{N}^k</script></span>. The type of <code>model</code> and its settings are specified in the <code>settings</code> dictionary. This model returns an estimation of <span class="arithmatex"><span class="MathJax_Preview">\Delta\widetilde{x}^k</span><script type="math/tex">\Delta\widetilde{x}^k</script></span> given a value <span class="arithmatex"><span class="MathJax_Preview">\Delta r^k=-r^k</span><script type="math/tex">\Delta r^k=-r^k</script></span>
$$
\Delta\widetilde{x}^k=\widetilde{N}^k \Delta r^k.
$$
Finally resulting in the update formula
$$
x^{k+1}=x^k+(\widetilde{N}^k-I)\Delta r^k=x^k-\widetilde{N}^k r^k+r^k.
$$</p>
<p>A symbolic schematic is given in the following figure.</p>
<p><img alt="iqni" src="images/iteration_iqni.png" title="Residual operator iterations" /></p>
<p>For more information with respect to the approximation of the Jacobian, refer to the <a href="https://pyfsi.github.io/coconut/models">models' documentation</a>.
More information about residual operator methods can be found in [<a href="#1">1</a>, <a href="#3">3</a>].</p>
<p>Beside the parameters required in the <a href="#the-class-coupledsolver">class <code>CoupledSolver</code></a>, the following parameters need to be included in the <code>settings</code> dictionary. They are listed in alphabetical order.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">parameter</th>
<th style="text-align: center;">type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>model</code></td>
<td style="text-align: center;">dict</td>
<td>Model component.</td>
</tr>
<tr>
<td style="text-align: right;"><code>omega</code></td>
<td style="text-align: center;">float</td>
<td>Relaxation factor.</td>
</tr>
</tbody>
</table>
<h2 id="ibqn">IBQN</h2>
<p>The <code>type</code> for this coupled solver is <code>coupled_solvers.ibqn</code>.</p>
<p>The abbreviation IBQN refers to <em>interface block quasi-Newton</em>.
In type of coupling iteration, the system 
$$
\begin{cases}
    \mathcal{F}(x)-y=0
    \newline
    \mathcal{S}(y)-x=0
\end{cases}
$$
is solved in block form.
Again, <span class="arithmatex"><span class="MathJax_Preview">\mathcal{F}</span><script type="math/tex">\mathcal{F}</script></span> is the first solver with input <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> and output <span class="arithmatex"><span class="MathJax_Preview">\widetilde{y}</span><script type="math/tex">\widetilde{y}</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\mathcal{S}</span><script type="math/tex">\mathcal{S}</script></span> is the second solver with input <span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> and output <span class="arithmatex"><span class="MathJax_Preview">\widetilde{x}</span><script type="math/tex">\widetilde{x}</script></span>. In this iteration scheme, the output of each solver is altered before being transferred to the other one.
Solving the system in block Newton-Raphson iterations results in
$$
    \begin{bmatrix}
        \mathcal{F}'(x) &amp; -I
        \newline
        -I &amp;   \mathcal{S}'(y)
    \end{bmatrix}
    \begin{bmatrix}
        \Delta x
        \newline
        \Delta y
    \end{bmatrix}
    =-
    \begin{bmatrix}
        \mathcal{F}(x)-y
        \newline
        \mathcal{S}(y)-x
    \end{bmatrix},
$$
where <span class="arithmatex"><span class="MathJax_Preview">\mathcal{F}'</span><script type="math/tex">\mathcal{F}'</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\mathcal{S}'</span><script type="math/tex">\mathcal{S}'</script></span> denote the Jacobians of the first and second solver, respectively.
These Jacobians are, however, not accessible and are approximated using a <code>model</code> as specified in the <code>settings</code> dictionary. To the first and second solver correspond <code>model_f</code>, denoted here by <span class="arithmatex"><span class="MathJax_Preview">M_f</span><script type="math/tex">M_f</script></span>, and <code>model_s</code>, denoted bye <span class="arithmatex"><span class="MathJax_Preview">M_s</span><script type="math/tex">M_s</script></span>, respectively. For example, <code>model_f</code> returns an estimation of <span class="arithmatex"><span class="MathJax_Preview">\Delta\widetilde{y}^k=\widetilde{y}^{k+1}-\widetilde{y}^k</span><script type="math/tex">\Delta\widetilde{y}^k=\widetilde{y}^{k+1}-\widetilde{y}^k</script></span> given <span class="arithmatex"><span class="MathJax_Preview">\Delta x^k=x^{k+1}-x^k</span><script type="math/tex">\Delta x^k=x^{k+1}-x^k</script></span>
$$
\Delta\widetilde{y}^k=M_f^k \Delta x^k.
$$</p>
<p>Solving for <span class="arithmatex"><span class="MathJax_Preview">x^{k+1}=x^k+\Delta x^k</span><script type="math/tex">x^{k+1}=x^k+\Delta x^k</script></span> requires solving the system
$$
\left(I-M_s^k M_f^k\right)\Delta x^k
=\widetilde{x}^k-x^k+M_s^k(\widetilde{y}^k-y^k)
$$
for <span class="arithmatex"><span class="MathJax_Preview">\Delta x^k</span><script type="math/tex">\Delta x^k</script></span>.
This is done matrix-free using the Generalized minimal residual method (GMRES).
Analogously, the input <span class="arithmatex"><span class="MathJax_Preview">y^{k+1}=y^k+\Delta y^k</span><script type="math/tex">y^{k+1}=y^k+\Delta y^k</script></span> for the structural solver by solving 
$$
\left(I-M_f^{k+1}M_s^k\right)\Delta y^k
=\widetilde{y}^{k+1}-y^k+M_f^{k+1}(\widetilde{x}^k-x^{k+1})
$$
for <span class="arithmatex"><span class="MathJax_Preview">\Delta y^k</span><script type="math/tex">\Delta y^k</script></span>.</p>
<p>A symbolic schematic is given in the following figure.</p>
<p><img alt="ibqn" src="images/iteration_ibqn.png" title="Block iterations" /></p>
<p>The actual approximation of the Jacobian occurs with the same <a href="https://pyfsi.github.io/coconut/models">models</a> as before.
More information about block methods can be found in [<a href="#1">1</a>].</p>
<p>Beside the parameters required in the <a href="#the-class-coupledsolver">class <code>CoupledSolver</code></a>, the following parameters need to be included in the <code>settings</code> dictionary. They are listed in alphabetical order.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">parameter</th>
<th style="text-align: center;">type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>absolute_tolerance_gmres</code></td>
<td style="text-align: center;">float</td>
<td>Absolute tolerance used in the GMRES method.</td>
</tr>
<tr>
<td style="text-align: right;"><code>model_f</code></td>
<td style="text-align: center;">dict</td>
<td>Model component corresponding to the first solver wrapper.</td>
</tr>
<tr>
<td style="text-align: right;"><code>model_s</code></td>
<td style="text-align: center;">dict</td>
<td>Model component corresponding to the second solver wrapper.</td>
</tr>
<tr>
<td style="text-align: right;"><code>omega</code></td>
<td style="text-align: center;">float</td>
<td>Relaxation factor.</td>
</tr>
<tr>
<td style="text-align: right;"><nobr><code>relative_tolerance_gmres</code></nobr></td>
<td style="text-align: center;">float</td>
<td>Relative tolerance used in the GMRES method.</td>
</tr>
</tbody>
</table>
<h2 id="iqnism">IQNISM</h2>
<p>The <code>type</code> for this coupled solver is <code>coupled_solvers.iqnism</code>.
This coupled solver is linked to the IQN-ILSM framework [<a href="#2">2</a>, <a href="#3">3</a>].</p>
<p>The abbreviation IQNISM refers to <em>interface quasi-Newton with inverse Jacobian from surrogate model</em>.
This coupled solver belongs in the same category as the IQNI coupled solver: the combination of the two solvers is seen as one system, where the input of the first solver is transferred unchanged to the second solver.
The difference between output and input of this system is called the residual <span class="arithmatex"><span class="MathJax_Preview">r^k=\widetilde{x}^k-x^k</span><script type="math/tex">r^k=\widetilde{x}^k-x^k</script></span>.</p>
<p>Just like for IQNI, a residual operator <span class="arithmatex"><span class="MathJax_Preview">\mathcal{R}(x)</span><script type="math/tex">\mathcal{R}(x)</script></span> is defined and the root of this system of non-linear equations is solved using Newton-Raphson iterations, as follows
$$
x^{k+1}=x^k-\widetilde{N}^k r^k+r^k,
$$
where <span class="arithmatex"><span class="MathJax_Preview">\widetilde{N}^k</span><script type="math/tex">\widetilde{N}^k</script></span> is an approximation of the inverse Jacobian of <span class="arithmatex"><span class="MathJax_Preview">\mathcal{R}</span><script type="math/tex">\mathcal{R}</script></span> with respect to <span class="arithmatex"><span class="MathJax_Preview">\widetilde{x}</span><script type="math/tex">\widetilde{x}</script></span>.</p>
<p>As in IQNI, this approximation is obtained using the <code>model</code> components.
Only here, two of them ar used: a <code>surrogate</code> model is used, in addition to a secant model.
The type of the models and their settings are specified in the <code>settings</code> dictionary:
The key of the surrogate model is <code>surrogate</code>, the key of the secant model is simply <code>model</code>.
Both of them are required. However, a dummy model can be used to disable one of them.
It is not recommended to disable the secant model (key <code>model</code>), as this model provides a Jacobian which is based on the actual problem.</p>
<p>The <code>surrogate</code> model solves a surrogate coupling problem at the start of every time step. The solution of this surrogate problem can be used as prediction (see <a href="https://pyfsi.github.io/coconut/predictors#surrogate">surrogate predictor</a>) and its Jacobian can be used here.
More information with respect to this type of model can be found in the <a href="https://pyfsi.github.io/coconut/models">models' documentation</a>.
If only the solution is to be used, the parameter <code>surrogate_modes</code> has to be set to <code>0</code>. This parameter denotes the number of modes from the surrogate Jacobian that should be used (starting from the first determined mode(s)).
Whether the surrogate solution is used for prediction, is determined by the <code>predictor</code> settings of the coupled solver. If the surrogate model does not provide a surrogate solution (only a surrogate Jacobian), surogate prediction is not possible.</p>
<p>The two models are combined as follows.
The secant model is used as before, but, as the secant Jacobian is defective (not full-rank), part of the residual is not <em>treated</em> by this Jacobian.
For the modes corresponding to the part of the residual, not covered by the secant Jacobian, the surrogate Jacobian is used.
Note that, in this way, the secant Jacobian has preference over the surrogate Jacobian.</p>
<p>If the coupled solver in the surrogate model uses IQNISM as well, a nested surrogate construction is created, where for the part of residual not treated by the first surrogate Jacobian the second surrogate is used.</p>
<p>Next to the parameters required in the <a href="#the-class-coupledsolver">class <code>CoupledSolver</code></a>, the following parameters need to be included in the <code>settings</code> dictionary. They are listed in alphabetical order.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">parameter</th>
<th style="text-align: center;">type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>model</code></td>
<td style="text-align: center;">dict</td>
<td>Model component.</td>
</tr>
<tr>
<td style="text-align: right;"><code>omega</code></td>
<td style="text-align: center;">float</td>
<td>(optional) Default: <code>1</code>. Relaxation factor for when the modes not covered by the surrogate model, when the secant model is not yet active.</td>
</tr>
<tr>
<td style="text-align: right;"><code>surrogate</code></td>
<td style="text-align: center;">dict</td>
<td>Surrogate component.</td>
</tr>
<tr>
<td style="text-align: right;"><code>surrogate_modes</code></td>
<td style="text-align: center;">int</td>
<td>(optional) Default: all modes. The number of modes from the surrogate Jacobian that should be used in the Jacobian approximation (starting from the first determined surrogate mode(s)).</td>
</tr>
<tr>
<td style="text-align: right;"><nobr><code>surrogate_synchronize</code></nobr></td>
<td style="text-align: center;">bool</td>
<td>(optional) Default: <code>true</code>. Whether or not the surrogate model is synchronized at the end of the time step (only if the surrogate offers this capability).</td>
</tr>
</tbody>
</table>
<p>This coupled solver is closely related to the IQN-ILSM framework described in [<a href="#2">2</a>].
The settings structure for the different surrogate models discussed in this work are:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">previous time steps (e.g. 50) (=reuse)</label><label for="__tabbed_1_2">other surrogate model</label><label for="__tabbed_1_3">previous time steps + other surrogate model</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coupled_solvers.iqnism&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;omega&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coupled_solvers.models.mvmf&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;q&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;surrogate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coupled_solvers.models.dummy_model&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="err">...</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="err">...</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coupled_solvers.iqnism&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coupled_solvers.models.mvmf&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;q&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;surrogate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coupled_solvers.models.surrogate&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">...</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="err">...</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="err">...</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coupled_solvers.iqnism&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coupled_solvers.models.mvmf&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;q&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;surrogate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coupled_solvers.models.surrogate&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">...</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="err">...</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="err">...</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="explicit">Explicit</h2>
<p>The <code>type</code> for this coupled solver is <code>coupled_solvers.explicit</code>.</p>
<p>In contrast to the coupled solvers presented above, which implement strongly coupled or implicit techniques,
the explicit coupled solver does not iterate between the solvers within a time step.
Instead, the solvers are only evaluated once per time step.
Therefore, equilibrium between fluid and structure is not exactly satisfied. 
This technique is suitable for problems with low added mass, such as aeroelastic problems.
For problems with high added mass, they will fail due to stability issues.</p>
<p>No additional parameters are required besides the parameters required in the <a href="#the-class-coupledsolver">class <code>CoupledSolver</code></a>.
For this coupled solver, the <code>convergence_criteria</code> are ignored.
The key <code>convergence_criteria</code> is still required, but it may remain empty.</p>
<h2 id="one-way">One-way</h2>
<p>The <code>type</code> for this coupled solver is <code>coupled_solvers.one_way</code>.</p>
<p>In the one-way coupled solver the fluid forces are coupled to the structural model without feedback of the structural deformation to the fluid solver.
This coupled solver can be used when the structural deformation due to the fluid forces may be neglected.</p>
<p>No additional parameters are required besides the parameters required in the <a href="#the-class-coupledsolver">class <code>CoupledSolver</code></a>.
For this coupled solver, the <code>convergence_criteria</code> and <code>preditors</code> are ignored.
The keys <code>convergence_criteria</code> and <code>predictors</code> are still required, but they may remain empty.</p>
<h2 id="test-single-solver">Test single solver</h2>
<p>The solver <code>test_single_solver</code> can be used to test new cases and solver settings. The idea behind this component is to only test one of the two solvers, while the other one is replaced by a dummy. This test environment inherits from the class <code>CoupledSolver</code>. The <code>type</code> for this coupled solver is <code>coupled_solvers.test_single_solver</code>.</p>
<h3 id="dummy-solver">Dummy solver</h3>
<p>To test only one solver, a dummy solver must be used. Such a dummy solver is implemented by a test class in the file <em><code>dummy_solver.py</code></em>. Its path starts in the folder from where the simulation is performed, e.g. the same folder level as <em><code>run_simulation.py</code></em>. Upon run-time an instance of this class is made.
The test class requires methods of the form <code>calculate_&lt;variable&gt;(x,y,z,n)</code>, with <code>&lt;variable&gt;</code> being a variable required by the tested solver, e.g. <code>displacement</code>, <code>pressure</code> or <code>traction</code>. How these variables are defined inside these methods, is up to the user. However, the methods need to return the right format: a 3-element list or numpy array for vector variables and a 1-element list or numpy array for scalar variables.
Some examples are given in the example <a href="https://pyfsi.github.io/coconut/test_single_solver">test_single_solver</a>. The test class name is provided in the JSON settings as a string. If no test class is provided or the value <code>None</code> is used, zero input will be used.</p>
<p>The JSON file requirements for the class <code>CoupledSolverTestSingleSolver</code> are different from the other coupled solvers in the sense that they only require the <code>type</code>, which is <code>coupled_solvers.test_single_solver</code>, the dictionary <code>test_settings</code> and the list <code>solver_wrappers</code> containing at least one solver wrapper. The keys for the <code>test_settings</code> dictionary are listed in alphabetical order below.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">parameter</th>
<th style="text-align: center;">type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>debug</code></td>
<td style="text-align: center;">bool</td>
<td>(optional) Default: <code>false</code>. Residual distribution is also saved in additional field <code>solution_r</code> for every iteration (see <a href="#save-results">results pickle file</a>).</td>
</tr>
<tr>
<td style="text-align: right;"><code>delta_t</code></td>
<td style="text-align: center;">float</td>
<td>(optional) Time step size to be used in the test. Is optional as long as this value is defined in the <code>settings</code> dictionary. If a different value is defined in both dictionaries, the one defined in <code>test_settings</code> is chosen.</td>
</tr>
<tr>
<td style="text-align: right;"><code>case_name</code></td>
<td style="text-align: center;">str</td>
<td>(optional) Name of the case used to store a <a href="https://docs.python.org/3/library/pickle.html">pickle</a> file with results. The pickle file will have the name <em><code>&lt;case_name&gt;_&lt;test_solver_working_directory&gt;_results.pickle</code></em>. If not provided, the value from <code>settings</code> is used or if <code>settings</code> is not present: <code>"case"</code>.</td>
</tr>
<tr>
<td style="text-align: right;"><code>save_results</code></td>
<td style="text-align: center;">int</td>
<td>(optional) Default: <code>0</code>. Time step interval at which a pickle file is written containing some main <a href="#save-results">results</a> for ALL previous time steps. If <code>0</code>, no such information is stored and no pickle file is written. If not provided, the value from <code>settings</code> is used or if <code>settings</code> is not present: <code>0</code>.</td>
</tr>
<tr>
<td style="text-align: right;"><code>solver_index</code></td>
<td style="text-align: center;">int</td>
<td>Has a value <code>0</code> or <code>1</code> and indicates the solver that one wants to test. <code>0</code> indicates the first solver wrapper that appears in the JSON-file, <code>1</code> the second one.</td>
</tr>
<tr>
<td style="text-align: right;"><code>test_class</code></td>
<td style="text-align: center;">str</td>
<td>(optional) Refers to the class to use in the <em><code>dummy_solver.py</code></em>. If not provided or <code>None</code>, zero input will be used.</td>
</tr>
<tr>
<td style="text-align: right;"><nobr><code>timestep_start</code></nobr></td>
<td style="text-align: center;">int</td>
<td>(optional) Time step to start from. If not provided the value defined in the <code>settings</code> dictionary is used. If the <code>settings</code> dictionary is not present, zero is used.</td>
</tr>
</tbody>
</table>
<p>Other dictionaries, used for the actual calculation can be kept, but will not be used, with the possible exception of the <code>settings</code> dictionary.
The <code>settings</code> dictionary is used to look up <code>delta_t</code>, <code>timestep_start</code>, <code>save_results</code> and <code>case_name</code> if not provided in <code>test_settings</code>. Note that <code>test_settings</code> has priority over the parameters defined in <code>settings</code>. This means a calculation can be tested, by only adding the <code>test_settings</code> dictionary and changing the coupled solver <code>type</code> to <code>coupled_solvers.test_single_solver</code> and without altering anything else.
An illustration can be found in the example <a href="https://pyfsi.github.io/coconut/test_single_solver">test_single_solver</a>.</p>
<p>The optional pickle file, which saves some <a href="#save-results">results</a>, uses the name as specified by the JSON settings followed by an underscore and the solver working directory.</p>
<p>During run time, the norm of <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> and <span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> are printed. A residual does not exist here. The arrays <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> and <span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> do not have a physical meaning, but are the in- and output of the first solver, which is typically the flow solver. Then, the vector <span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> will contain pressure and traction components for all points. Nonetheless, these values can be useful to verify that the solver wrapper runs.</p>
<p>The test environment <code>test_single_solver</code> tests only the <code>solver_wrapper</code> itself, no mapping is included.</p>
<h2 id="save-results">Save results</h2>
<p>In each coupled solver, a positive non-zero value can be assigned to the <code>save_results</code> parameter, in order to save some results into a <a href="https://docs.python.org/3/library/pickle.html">pickle</a> file. The key <code>case_name</code> dictates the name of this file as explained above. The pickle file is written corresponding to the time step interval as dictated by <code>save_results</code>, but contains information for all time steps.
In other words, if the parameter is non-zero, it only controls the writing frequency and not the content of the file. If <code>save_results</code> is zero, no result are kept and no file is written.
For a non-zero value of <code>save_restart</code>, a save for <a href="#saving-restart-files">restart purposes</a> also triggers the saving of the results file.
The pickle file may be used by the postprocessing files included with the examples. It contains a dictionary with the following keys:</p>
<table>
<thead>
<tr>
<th style="text-align: right;">key</th>
<th style="text-align: center;">value type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>solution_x</code></td>
<td style="text-align: center;">numpy array</td>
<td>Contains the values of the vector <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> (typically displacement) for every time step as columns of a 2 dimensional np-array. The initial value is included as well, such that the number of column will be one higher than the number of calculated time steps. The vector <span class="arithmatex"><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> refers to the input of the first solver wrapper.</td>
</tr>
<tr>
<td style="text-align: right;"><code>solution_y</code></td>
<td style="text-align: center;">numpy array</td>
<td>Contains the values of the vector <span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> (typically pressure and traction) for every time step as columns of a 2 dimensional np-array, similar to <code>solution_x</code>. The vector <span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> refers to the input of the second solver wrapper.</td>
</tr>
<tr>
<td style="text-align: right;"><code>interface_x</code></td>
<td style="text-align: center;">interface</td>
<td>Interface object used as input for the first solver wrapper.</td>
</tr>
<tr>
<td style="text-align: right;"><code>interface_y</code></td>
<td style="text-align: center;">interface</td>
<td>Interface object used as input for the second solver wrapper.</td>
</tr>
<tr>
<td style="text-align: right;"><code>iterations</code></td>
<td style="text-align: center;">list</td>
<td>Contains the performed number of coupling iterations for every time step.</td>
</tr>
<tr>
<td style="text-align: right;"><code>residual</code></td>
<td style="text-align: center;">list</td>
<td>Nested list, which contains for each time step a list, on its turn containing residuals, one for every iteration of that time step.</td>
</tr>
<tr>
<td style="text-align: right;"><code>run_time</code></td>
<td style="text-align: center;">float</td>
<td>Equals the total computation time, i.e. the time between initialization and finalization (excluding initialization).</td>
</tr>
<tr>
<td style="text-align: right;"><code>time_allocation</code></td>
<td style="text-align: center;">dict</td>
<td>Dictionary containing a detailed overview of the time spent in the different components for the current simulation. Upon restart, the time allocation of previous runs are stored in sequence under the key <code>previous_calculations</code>.</td>
</tr>
<tr>
<td style="text-align: right;"><code>delta_t</code></td>
<td style="text-align: center;">float</td>
<td>Equals the used time step size.</td>
</tr>
<tr>
<td style="text-align: right;"><nobr><code>timestep_start</code></nobr></td>
<td style="text-align: center;">int</td>
<td>Equals the used start time step.</td>
</tr>
<tr>
<td style="text-align: right;"><code>case_name</code></td>
<td style="text-align: center;">str</td>
<td>Name of the case.</td>
</tr>
<tr>
<td style="text-align: right;"><code>info</code></td>
<td style="text-align: center;">str</td>
<td>Additional info, such as date, restart history and hostname of machine on which simulation is run. Can be disabled using the optional parameter <code>anonymous</code>.</td>
</tr>
</tbody>
</table>
<p>In simulations with a large number of points on the interface and a very large number of time steps, this file might take up a larger amount of storage.</p>
<p>Finally, there is also a debug option, which can be activated by setting the boolean <code>self.debug</code> on <code>true</code> in the code file itself. Then, the above information is stored every iteration. Additionally, the residual vector is saved as well using the key <code>solution_r</code>, analogously to <code>solution_x</code> and <code>solution_y</code>. Note, however, that the pickle file can be become very large in that case.
This option is only meant for debugging a new coupling algorithm. It should not be used in combination with restart.</p>
<h2 id="restart">Restart</h2>
<p>The restart functionality is very useful to continue a calculation which has been stopped, either intentionally or unintentionally.
The goal is to continue as if the code had never been interrupted.</p>
<p>In order to restart from time step <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>, the coupled solver instructs the predictor and possibly one or more models to save the necessary data in the state at the end of time step <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> in a pickle file.
By saving the predictor, the initial guess at the start of the first time step(s) will be the same, as the predictor typically extrapolates the solution from the previous time step(s) in some way.
The model(s) are saved such that the behavior of the coupling algorithm is the same.
This is only important if the model behavior depends on data from previous time steps, e.g. models with reuse (<span class="arithmatex"><span class="MathJax_Preview">q&gt;0</span><script type="math/tex">q>0</script></span>).</p>
<p>Besides restarting the exact same simulation, it could be useful to change the settings from the coupled solver or occasional model(s) when restarting.
This is possible, refer to the <a href="https://pyfsi.github.io/coconut/models#restart">models</a> documentation for more details.
Changing the type of coupled solver or occasional model is also possible, but no information will be transferred between the different types, meaning that for example all information from previous time steps is lost.</p>
<p>For the predictors the same is true, except for the extrapolators for which there is information transfer.
See the documentation of the <a href="https://pyfsi.github.io/coconut/predictors#restart">predictors</a> for more details.</p>
<p>The following table gives an overview of the coupled solvers which save one or more additional components or values.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">type</th>
<th>additional components saved for restart</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>coupled_solvers.aitken</code></td>
<td><code>omega</code></td>
</tr>
<tr>
<td style="text-align: right;"><code>coupled_solvers.iqni</code></td>
<td><code>model</code></td>
</tr>
<tr>
<td style="text-align: right;"><code>coupled_solvers.ibqn</code></td>
<td><code>model_f</code> and <code>model_s</code></td>
</tr>
<tr>
<td style="text-align: right;"><code>coupled_solvers.iqnism</code></td>
<td><code>model</code> and <code>surrogate</code></td>
</tr>
</tbody>
</table>
<p>However, not only the predictor and coupling algorithm depend on previous time steps; this is typically also the case for the solvers.
Therefore, it is the responsibility of the solver wrappers, to set up the solvers correctly for restart: they need to ensure that the variables in the whole computational domain are set to the value of time step <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>.
Moreover, its vital that they reconstruct the exact same model parts as in the initial calculation.
In other words, the undeformed coordinates must be the same.
Conversely, they are not required to initialize the interfaces with the correct data from time step <span class="arithmatex"><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>, as this taken care of by the predictor in the coupled solver.
Only when both solver wrappers allow restart, is it possible to restart a calculation!</p>
<h3 id="saving-restart-files">Saving restart files</h3>
<p>During a calculation it is possible to save restart pickle files.
As described above the pickle file for restart has a name (<em><code>&lt;case_name&gt;_restart_ts&lt;time_step&gt;.pickle</code></em>), based on the setting <code>case_name</code>.</p>
<p>The frequency of saving a restart pickle file is determined by the <code>save_restart</code> interval as described above.
Remark that it is only useful to save the restart pickle file, when the solver data are saved as well.
Therefore, the <code>save_restart</code> parameter is transferred automatically to the solver wrappers.</p>
<p>If <code>save_results</code> is non-zero, a save of restart information also triggers the saving of the <a href="#save-results">results pickle file</a>, to avoid discontinuity of this file.</p>
<h3 id="performing-restart">Performing restart</h3>
<p>To restart a case, <code>timestep_start</code> has to be a positive integer above zero.
The first time step that will be calculated is <code>timestep_start</code> plus one.
The methodology described above does not allow to change any settings of the predictor or model(s), nor the type of coupled solver.
Upon restart, this condition is checked, as well as the presence of the pickle file for restart.
This file is identified by the setting <code>restart_case</code> as <em><code>&lt;restart_case&gt;_restart_ts&lt;timestep_start&gt;.pickle</code></em>.
Additionally, it is checked that the new model parts are exactly the same as the previous ones.</p>
<p>It is important to realize that the pickle file only makes sure that the initial guess and coupling algorithm work as before.
The physical effect of previous time steps dealt with by the solver wrappers.
<strong>Therefore, in order to be able to perform a restart, the solver files for the corresponding time step also need to be present!</strong></p>
<p>When performing restart, the new data will be neatly appended to the already existing results pickle file, leaving out existing time step data after the new time step start.
As a result, the results pickle file looks exactly as if the calculation was never stopped, except the fields <code>run_time</code>, <code>time_allocation</code> and <code>info</code>.
The latter provides a very short log of when restart is performed.</p>
<p>If the results pickle file would not be found for any reason, the user is informed and a new one is made, with the correct <code>timestep_start</code>.
Note that the presence of the restart pickle file on the other hand is required. If the <code>case_name</code> is changed, the restart can still be performed by providing the case name for restart using <code>restart_case</code> (see explanation above).</p>
<h2 id="references">References</h2>
<p><a id="1">[1]</a> 
<a href="http://hdl.handle.net/1854/LU-8685199">DelaissÃ© N., Demeester T., Fauconnier D. and Degroote J., "Comparison of different quasi-Newton techniques for coupling of black box solvers", in ECCOMAS 2020, Proceedings, Paris, France, 2021.</a></p>
<p><a id="2">[2]</a>
<a href="http://hdl.handle.net/1854/LU-8728347">DelaissÃ© N., Demeester T., Fauconnier D. and Degroote J., "Surrogate-based acceleration of quasi-Newton techniques for fluid-structure interaction simulations", Computers &amp; Structures, vol. 260, pp. 106720, 2022.</a></p>
<p><a id="3">[3]</a> 
<a href="https://doi.org/10.1007/s11831-023-09907-y">DelaissÃ© N., Demeester T., Haelterman R. and Degroote J., "Quasi-Newton methods for partitioned simulation of fluid-structure interaction reviewed in the generalized Broyden framework", Archives of Computational Methods in Engineering, vol. 30, pp. 3271-3300, 2023.</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.expand", "navigation.tracking", "toc.integrate"], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>