file set-batch-options n n n
(enable-dynamic-mesh-node-ids #t)
;file start "transcript_setup.txt"
file read-case 2D_liquid.msh
grid modify-zones zone-type fluid fluid

define user-defined user-defined-memory 12

define models viscous laminar y
define models solver pressure-based y
define models energy y n n n y
solve set equations flow y

define materials copy fluid air pcm
define materials change-create pcm , yes boussinesq 870 yes constant 2600 yes constant 0.15 yes constant 0.004 no yes 8.61e-4 no

define boundary-conditions fluid , y pcm n n n n , n , n y n
define boundary-conditions wall bottom n 0 n 0 n n n 0 y motion-bc-stationary n n ,
define boundary-conditions wall top n 0 n 0 n n n 0 y motion-bc-stationary n n ,
;heated wall 10 Â°C above solidus temp.
define boundary-conditions wall heated n 0 n 0 n y temperature n 309.15 y motion-bc-stationary n n ,
define boundary-conditions wall boundary n 0 n 0 n y temperature n 299.15 y motion-bc-stationary n n ,

define operating-conditions operating-pressure 0
define operating-conditions gravity y 0 -9.81

solve monitors residual check-convergence y y y y
solve monitors residual convergence-criteria 1e-4 1e-4 1e-4 1e-8

solve set discretization-scheme temperature 1
solve set discretization-scheme mom 1
; Standard (10) - Linear (11) - Second order (12) - Body force weighted (13) - PRESTO! (14)
solve set discretization-scheme pressure 11
solve set gradient-scheme n y
;solve set under-relaxation temperature 0.3

;Initialise liquid at liquidus temp.
solve initialize set-defaults temperature 299.15
solve initialize set-defaults pressure 0
solve initialize set-defaults x-velocity 0
solve initialize set-defaults y-velocity 0
solve initialize initialize-flow

; SIMPLE (20) - PISO (22) - coupled (24)
solve set p-v-coupling 20
solve set pseudo-time-method formulation 2
solve iterate 2000

define models unsteady-1st-order y
; SIMPLE (20) - PISO (22) - coupled (24)
solve set p-v-coupling 20
solve set discretization-scheme pressure 12
solve monitors residual convergence-criteria 1e-4 1e-4 1e-4 1e-8

define dynamic-mesh dynamic-mesh y n n n n
define dynamic-mesh controls smoothing y
define dynamic-mesh controls smoothing-parameters smoothing-method diffusion
define dynamic-mesh controls smoothing-parameters diffusion-coeff-function boundary-distance
define dynamic-mesh controls smoothing-parameters diffusion-coeff-parameter 1.0
define dynamic-mesh controls smoothing-parameters max-iter 50
define dynamic-mesh controls layering n
define dynamic-mesh controls remeshing n
; Last option below: exclude mesh motion in boundary conditions? y
define dynamic-mesh zones create top deforming faceted n y n y n y
define dynamic-mesh zones create bottom deforming faceted n y n y n y

file write-case-data 2D_fluid.cas.h5
exit
